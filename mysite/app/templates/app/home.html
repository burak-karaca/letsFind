{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'app/home.css' %}">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=PT+Sans:400,500,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Dosis:500,600,700' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet">
    <title>Document</title>
</head>
<body>


<!-- Navbar -->
<nav class="navbar navbar-expand-md navbar-light">
    <a class="navbar-brand" href="#!">
        <img src="{% static 'app/logo.png' %}" height="30" alt="mdb logo" style="width: 175px;height: 75px;">
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav1"
            aria-controls="basicExampleNav1" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <form method="post">
        {% csrf_token %}
        <div class="input-field first-wrap">
            {{form.product}}
        </div>
        <div class="input-field second-wrap">
            {{form.min_price}}
        </div>
        <div class="input-field second-wrap">
            {{form.max_price}}
        </div>
        <div class="input-field third-wrap">
            <button class="btn btn-success" id="buton" type="submit"><i class="fas fa-search"></i></button>
            {{form.field_name}}

        </div>
    </form>



<!--    <div class="collapse navbar-collapse" id="basicExampleNav1">-->

<!--        &lt;!&ndash; Right &ndash;&gt;-->
<!--        <ul class="navbar-nav ml-auto">-->
<!--            <li class="nav-item dropdown">-->
<!--                <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--                   aria-haspopup="true" aria-expanded="true">-->
<!--                    <i class="fas fa-shopping-cart pl-0"></i>-->
<!--                </a>-->
<!--                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                    <a class="dropdown-item" href="#!">Action</a>-->
<!--                    <a class="dropdown-item" href="#!">Another action</a>-->
<!--                    <a class="dropdown-item" href="#!">Something else here</a>-->
<!--                </div>-->
<!--            </li>-->
<!--            <li class="nav-item">-->
<!--                <a href="#!" class="nav-link waves-effect">-->
<!--                    Sign in-->
<!--                </a>-->
<!--            </li>-->
<!--            <li class="nav-item pl-2 mb-2 mb-md-0">-->
<!--                <a href="#!" type="button"-->
<!--                   class="btn btn-outline-info btn-md btn-rounded btn-navbar waves-effect waves-light">Sign up</a>-->
<!--            </li>-->
<!--        </ul>-->

<!--    </div>-->


</nav>



<div class="mainContainer">
    <div class="" id="basicExampleNav1"
    <!-- Right -->
<!--    <ul class="featuredItems">-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-tv"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-laptop"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-mobile-alt"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-mouse"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="far fa-keyboard"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-headphones-alt"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-solar-panel"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-sd-card"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-hdd"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-microchip"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-battery-quarter"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a class="nav-link dropdown-toggle waves-effect" id="navbarDropdownMenuLink3" data-toggle="dropdown"-->
<!--               aria-haspopup="true" aria-expanded="true">-->
<!--                <i class="fas fa-charging-station"></i>-->
<!--            </a>-->
<!--            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">-->
<!--                <a class="dropdown-item" href="#!">Action</a>-->
<!--                <a class="dropdown-item" href="#!">Another action</a>-->
<!--                <a class="dropdown-item" href="#!">Something else here</a>-->
<!--            </div>-->
<!--        </li>-->
<!--    </ul>-->
</div>

<div class="featuresoftheproducts">
    <h2>E-SHOPS</h2>
    <ul class="">
        {% for a in eshops %}
        <li class="list-group-item">
            <form method="post">
                <span class="eshoptexts">{{a.sortfilteredLinks}}</span><span id="check">{{form.checkbox}}</span>
                {% csrf_token %}

            </form>
        </li>
        {%endfor%}
    </ul>
</div>
<div class="containerofItems">

    {% for i in context %}

    <ul class="list-group" id="product">
        <li class="list-group-item" id="products" style="">
            <div class="image"><a href="{{i.links}}"><img src="{{i.images}}"></a></div>
            <div class="itemContainer"><a href="{{i.links}}"><span id="item">{{i.elements}}</span></a>
            </div>
        </li>
        <div class="priceandlink">
            <p><a href="{{i.links}}" id="link" class="btn btn-primary shops">{{i.shop}}</a></p>
            <p><a href="{{i.links}}"><span id="price" class="btn btn-primary prices">{{i.prices}}</span></a></p>
            <div class="currencydiv" style="visibility: hidden;">
                <ul>
                    <p class="euroanddollar"><span>EURO <span class="currencyexchange""></span></span></p>
                    <p  class="euroanddollar"><span>DOLLAR <span class="secondcurrencyexchange"></span></span></p>
                </ul>
            </div>

        </div>
    </ul>

    {% endfor %}

</div>
</div>
<script src="https://kit.fontawesome.com/18add7bb34.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<script>
    const checkboxes = Array.from(document.getElementsByClassName('checkbox'));
    const divElements = Array.from(document.getElementsByClassName('list-group'));
    const shops = Array.from(document.getElementsByClassName('shops'));
    const Arr = [];
    const arrofString = [];
    for(var i = 0; i<shops.length;i++){
        arrofString.push(shops[i].textContent)
    }
    checkboxes.forEach((element,index) => {
        const textofIndex = Array.from(document.getElementsByClassName('eshoptexts')[index].textContent);
        Arr.push(textofIndex.join(''))
        element.addEventListener('click', () => {
            let count=0
            checkboxes.forEach((element,index)=>{
                if(element.checked){
                    arrofString.forEach((currentShop,currentShopIndex) => {
                        if(currentShop === Arr[index])
                        divElements[currentShopIndex].style.display = 'block';
                    })
                }
                if(!element.checked){
                        arrofString.forEach((currentShop,currentShopIndex) =>{
                        if(currentShop === Arr[index])
                        divElements[currentShopIndex].style.display = 'none';
                    })
                    count++
                }
                console.log(checkboxes.length , count)
                if(checkboxes.length==count){
                    arrofString.forEach((currentShop,currentShopIndex) =>{
                        divElements[currentShopIndex].style.display = 'block';
                    })
                }
            })
        })
    })

    const currencyArray = [];
    const userAction = async () => {
    const response = await fetch('https://api.exchangeratesapi.io/latest');
    const myJson = await response.json();
        const stringArr = [];
        const numberofStringArr = [];
        const prices = Array.from(document.getElementsByClassName('prices'));
        const currencydiv = Array.from(document.getElementsByClassName('currencyexchange'));
        const secondcurrencydiv = Array.from(document.getElementsByClassName('secondcurrencyexchange'));
        //removing PLN string and deleting spaces from a string array
        for(var j = 0 ; j<prices.length;j++){
            stringArr.push(prices[j].textContent);
            numberofStringArr.push(stringArr[j].replace("PLN ", ""));
        }
        //converting string integers into integer array
        const priceArr = numberofStringArr.map(function(item) {
            return parseFloat(item, 10);
        });
        //getting rates from currency API
        const values =  Object.values(myJson.rates);

        //rounding currencies
        const euro = [];
        const usd = [];
        for(var l = 0 ; l < priceArr.length ; l++){
            euro.push(Math.round(priceArr[l] / values[19]));
            usd.push(Math.round(euro[l] * values[26]));
        }
        //appending currencies into the div elements
        for(var i = 0 ; i < values.length ; i++){
            currencydiv[i].innerHTML = euro[i];
            secondcurrencydiv[i].innerHTML = usd[i];
        }
    }
    userAction();


        const pricesdiv = Array.from(document.getElementsByClassName('currencydiv'));
        const prices = Array.from(document.getElementsByClassName('prices'));
        prices.forEach((el,index)=>{
            el.addEventListener('mouseover',(elem)=>{
                pricesdiv[index].style.visibility = 'visible';
            });
            el.addEventListener('mouseleave',(elem)=>{
                pricesdiv[index].style.visibility = 'hidden';
            })
        })
        console.log(pricesdiv,prices);


</script>
</body>
</html>